<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{/admin/index::header}"></div>
<body>
<div class="row">
    <div class="col-md-12">
        <h2>商品列表</h2>
    </div>
</div>
<!-- 按钮 -->
<div class="row">
    <!-- 列偏移 -->
    <div class="col-md-4 col-md-offset-8">
        <button class="btn btn-primary" id="commodity_add">新增</button>
        <button class="btn btn-danger" id="commodity_del">删除</button>
    </div>
</div>
<!-- 显示表格数据 -->
<div class="row">
    <div class="col-md-12">
        <table id="commodities_table" class="table table-hover">
            <thead>
                <tr>
                    <th>
                        <input type="checkbox" class="check_item"/>
                    </th>
                    <th>Id</th>
                    <th>商品名</th>
                    <th>商品状态</th>
                    <th>商品数量</th>
                    <th>发布用户</th>
                    <th>商品质量</th>
                    <th>创建日期</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>

            </tbody>

        </table>
    </div>
</div>

<!-- 显示分页栏 -->
<div class="row">
    <!-- 分页信息 -->
    <div class="col-md-6" id="page_info_msg">
    </div>
    <!-- 分页条信息 -->
    <div class="col-md-6" id="page_info_nav">
<!--        <nav aria-label="Page navigation" id="page_info_li">-->

<!--        </nav>-->
    </div>
</div>

<div th:replace="~{/admin/index::js}"></div>
</body>
<script th:inline="javascript">
    /*<![CDATA[*/
    //项目地址
    var PROJECT_PATH = [[${#httpServletRequest.getContextPath()}]];
    //记录数全局变量
    var totalrecord;
    //当前页
    var currentNum;

    //页面加载后执行
    $(document).ready(function () {
        toPage(1);
    })
    //发送请求获取那一页数据
    function toPage(pn){
        $.ajax({
            url:PROJECT_PATH+"/admin/commodities",
            data:"pn="+pn,
            type:"GET",
            success:function (result) {
                // console.log(result);
                //1、解析并显示商品数据
                buildCommodityTable(result);
                //2、解析并显示分页数据
                buildPageInfo(result);
                //3、解析并显示分页条数据
                buildPageNav(result);
            }
        });
    }
    //1、解析并显示商品数据
    function buildCommodityTable(result){
        var commodities = result.data.list
        // for (i=0;i<commodities.length;i++){
        //     console.log(commodities[i]);
        // }

        var tbody = $("#commodities_table>tbody");

        //清空数据
        tbody.empty();

        $.each(commodities,function(index,item){
            var checkBox = $("<td><input type='checkbox' class='check_item'/></td>");
            var comIdElm = $("<td></td>").append(item.commodityId);
            var comNameElm = $("<td></td>").append(item.commodityName);
            var comStatusElm = $("<td></td>").append(item.commodityStatusMsg);
            var comNumElm = $("<td></td>").append(item.commodityNum);
            var comUserElm = $("<td></td>").append();
            var comQualityElm = $("<td></td>").append(item.commodityQuality);
            var comCreateDateElm = $("<td></td>").append(item.commodityCreateDate);
            var comOperateElm = $("<td></td>").append();

            var editButTd = $("<button></button>").addClass("btn btn-primary btn-sm edit_btn").attr("aria-hidden","true")
                .append($("<span></span>").addClass("glyphicon glyphicon-pencil")).append("编辑");
            //在创建编辑按钮时加上用于显示员工id的属性
            editButTd.attr("edit_id",item.commodityId);
            var delButTd = $("<button></button>").addClass("btn btn-danger btn-sm delete_btn").attr("aria-hidden","true")
                .append($("<span></span>").addClass("glyphicon glyphicon-trash")).append("删除");
            delButTd.attr("delete_id",item.commodityId);

            comOperateElm.append(editButTd).append(" ").append(delButTd);

            $("<tr></tr>").append(checkBox).append(comIdElm).append(comNameElm).append(comStatusElm)
                .append(comNumElm).append(comUserElm).append(comQualityElm).append(comCreateDateElm).append(comOperateElm)
                .appendTo(tbody);
        });
    }

    //2、解析并显示分页数据
    function buildPageInfo(result){
        var pageInfo = result.data
        //清空数据
        $("#page_info_msg").empty();
        // 当前第 页，总共 页,总共 条记录
        $("#page_info_msg").append("当前第"+pageInfo.pageNum+
            "页，总共"+pageInfo.pages+
            "页,总共"+pageInfo.total+"条记录");
        //记录数全局变量
        totalrecord = pageInfo.total;
        //当前页
        currentNum = pageInfo.pageNum;
    }

    //3、解析并显示分页条数据
    function buildPageNav(result){
        var divTag = $("#page_info_nav");
        //清空列表
        divTag.empty();

        var pageInfo = result.data;
        //列表
        var ulTag = $("<ul></ul>").addClass("pagination");
        //首页
        var firstPage = $("<li></li>").append($("<a></a>").append("首页").addClass("page-link")).addClass("page-item");
        //末页
        var lastPage = $("<li></li>").append($("<a></a>").append("末页").addClass("page-link")).addClass("page-item");
        //上一页
        var prePage = $("<li></li>").append($("<a></a>").append($("<span></span>").append("&laquo;").attr("aria-hidden","true")).addClass("page-link")).addClass("page-item");
        //上页及首页动作
        if(pageInfo.hasPreviousPage == false){
            prePage.addClass("disabled");
        }else{
            //点击翻页
            prePage.click(function(){
                toPage(pageInfo.pageNum-1)
            });
            //点击回首页
            firstPage.click(function(){
                toPage(1);
            });
        }
        //下一页
        var nextPage = $("<li></li>").append($("<a></a>").append($("<span></span>").append("&raquo;").attr("aria-hidden","true")).addClass("page-link")).addClass("page-item");
        //下页及末页页动作
        if(pageInfo.hasNextPage == false){
            nextPage.addClass("disabled");
        }else{
            //点击翻页
            nextPage.click(function(){
                toPage(pageInfo.pageNum+1)
            });
            //点击回末页
            lastPage.click(function(){
                toPage(pageInfo.pages);
            });
        }
        ulTag.append(firstPage).append(prePage);

        //中间页
        $.each(pageInfo.navigatepageNums,function(index,item){
            var numPage = $("<li></li>").append($("<a></a>").append(item).addClass("page-link")).addClass("page-item");;
            if(pageInfo.pageNum == item){
                numPage.addClass("active");
            }else{
                //点击发送ajax请求获取数据
                numPage.click(function(){
                    toPage(item);
                });
            }
            ulTag.append(numPage);
        });

        ulTag.append(nextPage).append(lastPage);

        var navTag = $("<nav></nav>").attr("aria-label","Page navigation example");

        navTag.append(ulTag).appendTo(divTag);
    }


    //日期格式化
    // function dateFormat(fmt, date) {
    //     let ret;
    //     const opt = {
    //         "Y+": date.getFullYear().toString(),        // 年
    //         "m+": (date.getMonth() + 1).toString(),     // 月
    //         "d+": date.getDate().toString(),            // 日
    //         "H+": date.getHours().toString(),           // 时
    //         "M+": date.getMinutes().toString(),         // 分
    //         "S+": date.getSeconds().toString()          // 秒
    //         // 有其他格式化字符需求可以继续添加，必须转化成字符串
    //     };
    //     for (let k in opt) {
    //         ret = new RegExp("(" + k + ")").exec(fmt);
    //         if (ret) {
    //             fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")))
    //         };
    //     };
    //     return fmt;
    // }
    /*]]>*/
</script>
</html>